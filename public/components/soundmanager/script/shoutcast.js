(function($){"use strict";function SHOUTcast(opt){this._attr={};if(undefined===opt){opt={};}
this.playedInterval=opt.playedInterval||opt.interval||30000;this.statsInterval=opt.statsInterval||opt.interval||5000;this.host=opt.host;this.port=parseInt(opt.port,10)||8000;this.stream=parseInt(opt.stream,10)||1;this.stats_path=opt.stats_path||'stats';this.played_path=opt.played_path||'played';this._statsinterval=null;this._playedinterval=null;this._stats=opt.stats||function(){};this._played=opt.played||function(){};}
SHOUTcast.prototype.get=function(k,d){return k?(typeof this._attr[k.toLowerCase()]!=='undefined'?this._attr[k.toLowerCase()]:d):this._attr;};SHOUTcast.prototype.stats=function(fn){var that=this,r,url='http://'+this.host+':'+this.port+'/'+this.stats_path+'?sid='+this.stream+'&json=1';console.log("DELETING INTERVAL = "+this._statsinterval);clearInterval(this._statsinterval);console.log("[this.host] = "+this.host);fn=fn||function(){};r=$.ajax({url:url,dataType:'jsonp',timeout:'2000'});r.success(function(data){if(typeof data!=='object'||typeof data.streamstatus==='undefined'){that._status=0;return;}
that._status=data.streamstatus===1?2:1;that._attr=data;that._attr.status=that.getStatusAsText();fn.call(that,that._attr);that._stats(that._attr);});r.error(function(){that._status=0;that._attr.status=that.getStatusAsText();fn.call(that,that._attr);that._stats(that._attr);});return this;};SHOUTcast.prototype.played=function(fn){var that=this,url='http://'+this.host+':'+this.port+'/'+this.played_path+'?sid='+this.stream+'&type=json';console.log("===================>"+url);$.ajax({url:url,dataType:'jsonp',timeout:2000,success:function(data){if(!data instanceof Array){return;}
fn&&fn.call(that,data);that._played(data);}});return this;};SHOUTcast.prototype.startStats=function(){console.log("\n ======= \n STOPPING STATS \n ========= \n");this.stopStats();this.stats();if(this._statsinterval){console.log("this._statsinterval ===>"+this._statsinterval);clearInterval(this._statsinterval);}
this._statsinterval=setInterval($.proxy(this.stats,this),this.statsInterval);return this;};SHOUTcast.prototype.stopStats=function(){console.log("[STOP]");this._statsinterval&&clearInterval(this._statsinterval);return this;};SHOUTcast.prototype.startPlayed=function(){this.stopPlayed();this.played();this._playedinterval=setInterval($.proxy(this.played,this),this.playedInterval);return this;};SHOUTcast.prototype.stopPlayed=function(){this._playedinterval&&clearInterval(this._playedinterval);return this;};SHOUTcast.prototype.getStatus=function(){return this._status;};SHOUTcast.prototype.getStatusAsText=function(){return['Offline','Awaiting Connection','On Air'][this._status];};SHOUTcast.prototype.onAir=function(){return this._status===2;};$.SHOUTcast=function(opt){return new SHOUTcast(opt);};var console={};console.log=function(){};window.console=console;}(jQuery));